# IMO 2021 A8, Generalized Version

Let $R$ be an integral domain.
Find all functions $f : \R \to R$ such that, for all $a, b, c \in \R$,
$$ (f(a) - f(b)) (f(b) - f(c)) (f(c) - f(a)) = f(ab^2 + bc^2 + ca^2) - f(a^2 b + b^2 c + c^2 a). \tag{*} $$







# Answer

Either $f = C$, $f = x \mapsto \pm \phi(x) + C$, or $f = x \mapsto \pm \phi(x)^3 + C$ for some ring homomorphism $\phi : \R \to R$ and $C \in R$.







# Solution

We call a function $f : \R \to R$ good if it satisfies $(*)$.
It is easy to check that, for any good function $f$, $-f$ is good and $f + C$ is good for any constant $C \in R$.
Thus, we may WLOG assume that $f(0) = 0$ whenever necessary.
This also means that one only has to check that the zero map is good and, for any ring homomorphism $\phi : \R \to R$, $\phi$ and $x \mapsto \phi(x)^3$ works.
Checking for the zero map and the ring homomorphism as a map itself is straightforward.
However, checking for $x \mapsto \phi(x)^3$ is not.

(In the corresponding `.lean` file, we just use `ring` tactic and let the computer check the identity.)

Now, let $f$ be an arbitrary good function.
We divide into two, rather lengthy cases.



## Case 1: $f$ is not injective.

We prove that $f$ must be constant.

For any $a, b \in \R$ such that $f(a) = f(b)$, $(*)$ gives us
$$ \forall c \in \R, \quad f(ab^2 + bc^2 + ca^2) = f(a^2 b + b^2 c + c^2 a). \tag{1} $$
We play with this equality until we that $f$ is constant.

By $(1)$, if $f(a) = f(0)$ for some $a \in \R$, then $f(a^2 c) = f(ac^2)$ for any $c \in \R$.
Swapping $c$ with $-c$ and comparing gives us $f(ac^2) = f(-ac^2)$.
If $a$ is positive, then replacing $c$ with $\sqrt{c/a}$ gives us $f(c) = f(-c)$ for any $c \in \R$, so $f$ is even.
When $a$ is non-negative, we instead replace $c$ with $\sqrt{c/(-a)}$ to get that $f$ is even.
Either way, if $f(a) = f(0)$ for some $a \in \R \setminus \{0\}$, then $f$ is even.

Now, suppose that $f$ is even.
For an arbitrary $x \in \R$, plugging $a = x$, $b = -x$, and $c = dx$ into $(1)$ for an arbitrary $d \in \R$ gives us
$$
\begin{align*}
f(x^3 - d^2 x^3 + dx^3) &= f(-x^3 + dx^3 + d^2 x^3), \\
f(x^3 (1 + d - d^2)) &= f(x^3 (-1 + d + d^2)).
\end{align*}
$$
Using $d = \phi = \dfrac{1 + \sqrt{5}}{2}$ gives us $f(2 \phi x^3) = f(0)$ for any $x \in \R$.
Now, replace $x$ with $\sqrt[3]{x/(2 \phi)}$ to get that $f$ is indeed constant.
Thus, it remains to show that, if $f$ is not injective, then $f(x) = f(0)$ for some $x \in \R$.

For convenience, we call a real number $t$ _special_ if $f(tx) = f(x)$ for some $x \in \R \setminus \{0\}$. It is easy to check that, if $t \neq 0$ is a special real number, then $t^{-1}$ is also special.
Now, since $f$ is not injective, there exists $x, t \in \R$ with $x \neq 0$ and $t \neq 1$ such that $f(tx) = f(x)$.
That is, there exists a special real number not equal to $1$, say $t_0$.
We will work with this special number.

Let $t$ be a special real number, and consider some $x \neq 0$ such that $f(tx) = f(x)$.
Replacing $a$, $b$, and $c$ with $tx$, $x$, and $dx$ for arbitrary $d \in \R$ in $(1)$ gives us
$$ f(x^3 (t + d^2 + t^2 d)) = f(x^3 (t^2 + d + d^2 t)). \tag{2} $$
With this equation, we proceed with the following lemmas.

__Lemma 1.1__:
> If $t$ is a special number, then $t^4$ is also special.

__Proof__:
> The lemma clearly holds for $t = 0$, so now assume that $t \neq 0$.
> Pick some $x \neq 0$ such that $f(tx) = f(x)$.
> Now, plugging $d = -t^2$ into $(2)$ gives us $f(x^3 t) = f(x^3 t^5)$.
> Since $x, t \neq 0$, this means that $t^4$ is indeed special.

Since $t_0 \neq 1$, we have either $t_0 \leq 0$, $0 < t_0 < 1$, or $t_0 > 1$.
In the second case, $t_0^{-1}$ is also special and $t_0^{-1} > 1$.
So, without loss of generality, we can assume that either $t_0 \leq 0$ or $t_0 > 1$.
Next, by Lemma 1.1 and small induction, for any special real number $t$ and $n \in \Z_{\geq 0}$, $t^{4^n}$ is also special.
In the case $t_0 > 1$, there must exist $n \geq 0$ such that $t_0^{4^n} > 2$.
Then, replacing $t_0$ with $t_0^{4^n}$, we can assume WLOG that $t_0 > 2$.
We now finish this case with the following lemma.

__Lemma 1.2__:
> If there exists a special number $t$ with either $t \leq 0$ or $t > 2$, then $0$ is special.

In particular, there exists $x \neq 0$ such that $f(x) = f(0)$, and we are done.

__Proof__:
> If $t = 0$, then we are done, so now assume that either $t < 0$ or $t > 2$.
> Let $x$ be a non-zero real number such that $f(tx) = f(x)$.
> As a quadratic polynomial in $d$, the discriminant of $P(d) = d^2 + t^2 d + t$ is $t^4 - 4t$, which is non-negative for both $t < 0$ and $t > 2$.
> In particular, $P$ has a real root, say $d$.
> Thus, using the same $x$, $t$, and $d$ in $(2)$ gives us $f(x^3 (t^2 + d + d^2 t)) = f(0)$.
> Since $x \neq 0$, it remains to show that $t^2 + d + d^2 t \neq 0$.
>
> The equation $d^2 + t^2 d + t = 0$ can be rearranged to $d^2 + t = -t^2 d$.
> Then $t^2 + d + d^2 t = (d^2 + t) t + d = -t^3 d + d = (1 - t^3) d$.
> Since $d$ is a root of the polynomial $d^2 + t^2 d + t$ with $t \neq 0$, we have $d \neq 0$.
> Since we have either $t < 0$ or $t > 2$, we have $1 - t^3 \neq 0$.
> This proves the lemma.



## Case 2: $f$ is injective.

We will thoroughly assume that $f(0) = 0$ in this case.
First, we prove that $f(1) = \pm 1$, $f$ is odd, and that $f$ is multiplicative if $f(1) = 1$.

__Lemma 2.1__:
> We have $f(1) = \pm 1$ and $f$ is odd.
> Furthermore, if $f(1) = 1$, then $f$ is multiplicative.

__Proof__:
> First, for any $a, b \in \R$, plugging $c = 0$ into $(*)$ gives us
> $$
> \begin{align*}
> -(f(a) - f(b)) f(a) f(b) &= f(ab^2) - f(a^2 b), \\
> f(a) f(b)^2 - f(a)^2 f(b) &= f(ab^2) - f(a^2 b). \tag{3}
> \end{align*}
> $$
> Plugging $b = 1$ gives us $f(a) f(1)^2 - f(a)^2 f(1) = f(a) - f(a^2)$.
> Subtracting this equation with the same equation using $-a$ in place of $a$ gives us
> $$
> \begin{align*}
> (f(a) - f(-a)) f(1)^2 - (f(a)^2 - f(-a)^2) f(1) &= f(a) - f(-a), \\
> (f(a) - f(-a)) f(1) (f(1) - f(a) - f(-a)) &= f(a) - f(-a).
> \end{align*}
> $$
> For $a \neq 0$, since $f$ is injective, we have $f(a) \neq f(-a)$.
> Thus, we have $f(1) (f(1) - f(a) - f(-a)) = 1$ for any $a \neq 0$.
> Rearranging in the fraction field of $R$, we have $f(1) \neq 0$ and $f(a) + f(-a) = C$ for any $a \in \R \setminus \{0\}$, where $C = f(1) - f(1)^{-1}$.
>
> Now, by substituting $b = a^{-1}$ and $c = 0$ into $(*)$, for any $a \in \R$ non-zero,
> $$ -(f(a) - f(a^{-1})) f(a) f(a^{-1}) = f(a^{-1}) - f(a). $$
> For $a \notin \{-1, 0, 1\}$, we have $a \neq a^{-1}$ as well.
> So, using injectivity gives us $f(a) f(a^{-1}) = 1$.
> In particular, $f(a)$ must be a unit for any $a \notin \{-1, 0, 1\}$ and $f(a^{-1}) = f(a)^{-1}$.
>
> From the previous paragraph, we have $f(2) + f(-2) = f(2)^{-1} + f(-2)^{-1} = C$.
> Then $f(2) + f(-2) = \dfrac{f(2) + f(-2)}{f(2) f(-2)}$, so either $C = f(2) + f(-2) = 0$ or $f(2) f(-2) = 1$.
> If the latter holds, then $f(-2) = f(1/2)$ and thus $-2 = 1/2$ in $\R$; a contradiction.
> Thus, the former holds; we have $C = 0$ and thus $f(a) + f(-a) = 0$ for any $a \neq 0$.
> Since $f(0) = 0$, we get that $f$ is indeed odd.
>
> Now, recall the equation $f(1) (f(1) - f(a) - f(-a)) = 1$ for any $a \neq 0$.
> This equation now reduces to $f(1)^2 = 1 \implies f(1) = \pm 1$.
> Thus, it now remains to show that $f$ is indeed multiplicative for $f(1) = 1$.
>
> By $(3)$ and the fact that $f$ is odd, we have
> $$
> \begin{align*}
> 2 f(a)^2 f(b)
> &= (f(a)^2 f(b) - f(a) f(b)^2) + (f(-a)^2 f(b) - f(-a) f(b)^2) \\
> &= f(a^2 b) - f(a b^2) + f(a^2 b) - f(-ab^2) \\
> &= 2 f(a^2 b).
> \end{align*}
> $$
> Since we are working in an arbitrary domain, it might be not possible to cancel $2$ out.
> This happens only when $char(R) = 2$.
> However, if this holds, then in $R$, we have $f(1) = 1 = -1 = f(-1)$; the latter holds since $f$ is odd.
> Then we get $1 = -1$ in $\R$ by injectivity; a contradiction.
> That is, there can be no good injective function in the case $char(R) = 2$.
> Thus, it remains to consider the case $char(R) \neq 2$.
>
> For $char(R) \neq 2$, since $R$ is a domain, we can cancel $2$ out of the equation.
> We get $f(a)^2 f(b) = f(a^2 b)$ for any $a, b \in \R$.
> Now, assume that $f(1) = 1$.
> Plugging $b = 1$ into this equation gives $f(a)^2 = f(a^2)$ for all $a \in \R$.
> Then the previous equation can be replaced with $f(a) f(b) = f(ab)$ for any $a, b \in \R$ with $a \geq 0$.
> Finally, for $a \leq 0$, we have $f(a) f(b) = -f(-a) f(b) = -f(-ab) = f(ab)$.
> This shows that $f$ is indeed multiplicative.

Notice that the above proof also shows that when $char(R) = 2$, there can be no injective good functions.
Since we are searching for one, for the rest of the proof, we assume that $char(R) \neq 2$ if neccessary.

From now on, we will assume WLOG that $f(1) = 1$.
The only other case is $f(1) = -1$; but then $-f$ is good with $(-f)(1) = 1$.

__Lemma 2.2__:
For any $x, y \in \R$,
$$ 2 f(x)^2 - 2 = (f(x^2 + y) + f(x^2 - y)) - (f(1 + xy) + f(1 - xy)). $$

__Proof__:
> ...










# Implementation Details

We have to manually define the complete third root in $\R$ as we need it for our proof.
