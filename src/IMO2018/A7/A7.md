# IMO 2018 A7, Generalized Version

Let $n$ be a positive integer and $p \geq q > 0$ be real numbers.
Find the maximal value of
$$ S = \sum_{k = 1}^{2n} \sqrt[3]{\frac{a_k}{a_{k + 1} + q}}, $$
where $a_1, a_2, \ldots, a_{2n}$ are non-negative real numbers such that
$$ \sum_{k = 1}^{2n} a_k = 2np. $$
Here, we denote $a_{2n + 1} = a_1$.



# Answer

If $p \geq q$, then $2n \sqrt[3]{\dfrac{p + q}{4q}}$.

If $p < q$, then $2n \sqrt[3]{\dfrac{p}{p + q}}$.



# Solution

Official solution: <https://www.imo-official.org/problems/IMO2018SL.pdf>

We follow Solution 2 of the official solution.
While the solution only extends to the case $p \geq q$, the Holder's inequality is also used for the case $p < q$.
The original problem is just the special case where $(n, p, q) = (2, 25, 7)$.

In both cases, we start with the Holder's inequality, which gives us $(S/N)^3 \leq t^2 r$, where
$$ N := 2n, \quad t := \frac{1}{N} \sum_{k = 1}^N \sqrt{a_k}, \quad r := \frac{1}{N} \sum_{k = 1}^N \frac{1}{a_k + q}. $$
We then give a good bound for $r$ in terms of $n$ (or $N$), $p$, $q$, and $t$.

## Case 1: $p < q$

By Cauchy-Schwarz inequality,
$$ r = \frac{1}{q} \left(1 - \frac{1}{N} \sum_{k = 1}^N \frac{a_k}{a_k + q}\right) \leq \frac{1}{q}\left(1 - \frac{t^2}{p + q}\right). $$
So, we have
$$ \left(\frac{S}{N}\right)^3 \leq \frac{t^2}{q} \left(1 - \frac{t^2}{p + q}\right). $$
On the other hand, QM-AM ineqality gives us $t^2 \leq p < \frac{p + q}{2}$, so
$$ \left(\frac{S}{N}\right)^3 \leq \frac{p}{q} \left(1 - \frac{p}{p + q}\right) = \frac{p}{p + q} \implies S \leq N \sqrt[3]{\frac{p}{p + q}}. $$
On the other hand, equality is clearly attained when $a_k = p$ for each $k \leq n$.

## Case 2: $p \geq q$

We follow the idea from the official solution: bound $\dfrac{1}{x^2 + q}$ for any $x \in \R$ using the inequality $\dfrac{(x^2 + q - cx)^2}{x^2 + q} \geq 0$ for some $c > 0$.
This inequality is equivalent to
$$ x^2 + (c^2 + q) - 2cx \geq \frac{c^2 q}{x^2 + q} \iff \frac{1}{x^2 + q} \leq \frac{x^2 + (c^2 + q) - 2cx}{c^2 q}. $$
Thus we get
$$ r \leq \frac{p + (c^2 + q) - 2ct}{c^2 q} \implies \left(\frac{S}{N}\right)^3 \leq \frac{t^2 (p + q + c^2 - 2ct)}{c^2 q}. $$
But by AM-GM inequality,
$$ (ct)^2 (p + q + c^2 - 2ct) \leq \left(\frac{p + q + c^2}{3}\right)^3. $$
Optimizing, we pick $c = \sqrt{2(p + q)}$, giving us
$$ \left(\frac{S}{N}\right)^3 \leq \frac{p + q}{4q}. $$

Equality is attained when $a_k = u$ for $k$ odd and $a_k = v$ for $k$ even (or vice versa), where $u = p + \sqrt{p^2 - q^2}$ and $v = p - \sqrt{p^2 - q^2}$.
Note that $u + v = 2p$ and $uv = q^2$.
The equality reduces to
$$ \sqrt[3]{\frac{u}{v + q}} + \sqrt[3]{\frac{v}{u + q}} = \sqrt[3]{\frac{2(p + q)}{q}}. $$



# Extra notes

In both cases, the given example of equality case is unique up to cyclic permutation.
This is easy to derive from the equality cases of the inequality used in the proof.



# Implementation details

We will use `nnreal` as opposed to `real`.
Also, for the case where $p \leq q$, the same bound also holds with $2n$ replaced by odd integers.
